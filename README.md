# Описание проекта

Данный API, реализованный на базе FastAPI + SQLAlchemy + Alembic + PostgreSQL, создан для реализации простейшего мессенджера.
Реализованы функции
следующие операции:

1. Регистрация пользователей
2. Получение токена доступа по логину и паролю
2. Поиск пользователей по никнейму
3. Внесение изменений в личные данные
4. Отправка сообщений другому пользователю

Аутентификация пользователей происходит через токены, которые отправляются в заголовках запросов.

# Документация, настройка окружения и базы данных

## Документация

Подробная документация по API расположена по адресу (проект при этом должен быть запущен):

```http request
    /docs/
```

или

```http request
    /redoc/
```

Там же можно и проверить функциональность API

## Установка виртуального окружения и библиотек/пакетов

Установка всех необходимых библиотек производится с использованием файла с зависимостями requirements.txt

Перед установкой пакетов и библиотек, необходимо удостовериться, что все действия происходят внутри виртуального
окружения. Поэтому сначала необходимо его создать (если этого еще не было сделано)

```text
python3 -m venv venv (python3 - unix / python - windows)
```

Данная команда создаст папку venv в папке, откуда была выполнена команда, и в терминале появится запись *(venv)*
Теперь можно выполнить установку всех требуемых для работы библиотек и пакетов.
Для этого необходимо в терминале (находясь в папке, в которой расположен файл requirements.txt) выполнить следующую
команду:

```text
pip install -r requirements.txt
```

## Подготовка базы данных PostgreSQL

Подключаемся к консоли Postgres, выполнив следующий код (postgres это суперюзер)

```text
sudo -u postgres psql (linux)
psql -U postgres (windows)
```

Создаем базу данных, создаем пользователя, меняем некоторые настройки по рекомендации из документации Django
(кодировка, чтение транзакций и часовой пояс), открываем для нового пользователя все возможности работы с новой БД

```postgresql
CREATE DATABASE db_name;
CREATE USER username WITH PASSWORD 'password';
ALTER ROLE username SET client_encoding TO 'utf8';
ALTER ROLE username SET default_transaction_isolation TO 'read committed';
ALTER ROLE username SET timezone TO 'UTC';
GRANT ALL PRIVILEGES ON DATABASE db_name TO username;
```

В директории вместе с текущим файлом расположен файл ".env.template". Нужно переименовать его в ".env",
а потом заполнить по принципу:

```dotenv
# в соответствии с созданными пользователем и БД
DB_NAME=name_of_postgresql_db
DB_USER=username_for_access_to_postgresql_db
DB_PASS=password_for_access_to_postgresql_db
DB_HOST=host_for_postgresql_db
DB_PORT=port_for_postgresql_db

# теперь создаем секретный ключ, которым будем шифровать пароли, алгоритм для шифровки и время, которое будет 
# действовать токен в минутах
SECRET_KEY=your_secret
ALGORITHM=algoritm
ACCESS_TOKEN_EXPIRE_MINUTES=minutes

```

## Миграции в базу данных

Находясь в директории, где расположен файл alembic.ini необходимо выполнить миграции в базу данных, чтобы создались
нужные таблицы и связи

```commandline
alembic upgrade head
```

# Запуск

При клонировании репозитория у Вас будет папка workin_messenger_FastAPI со всеми файлами проекта.. Из этой папки
выполняем команду:

```commandline
uvicorn src.main:app --reload
```